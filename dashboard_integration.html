<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>[v7] CS ìƒë‹´ í†µí•© ëŒ€ì‹œë³´ë“œ</title>
  <style>
    /* ========================================
       ì „ì—­ ìŠ¤íƒ€ì¼
       ======================================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', 'Malgun Gothic', Arial, sans-serif;
      background: #f5f7fa;
      color: #333;
    }

    .container {
      max-width: 1920px;
      margin: 0 auto;
      padding: 20px;
    }

    /* ========================================
       í—¤ë”
       ======================================== */
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 30px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .header h1 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .header p {
      font-size: 14px;
      opacity: 0.9;
    }

    /* ========================================
       í•„í„° ì˜ì—­
       ======================================== */
    .filter-section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .filter-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 15px;
      color: #333;
    }

    .filter-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: flex-end;
      margin-bottom: 12px;
    }

    .filter-controls:last-child {
      margin-bottom: 0;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .filter-group label {
      font-size: 14px;
      font-weight: 500;
      color: #555;
    }

    .filter-group input,
    .filter-group select {
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
      min-width: 160px;
      max-width: 250px;
      transition: border-color 0.2s;
    }

    .filter-group input[type="text"] {
      min-width: 200px;
    }

    .filter-group input:focus,
    .filter-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .filter-group select:disabled {
      background-color: #f5f5f5;
      color: #999;
      cursor: not-allowed;
    }

    .btn {
      padding: 10px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover {
      background: #5568d3;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    /* ========================================
       íƒ­ ì˜ì—­
       ======================================== */
    .tabs {
      background: white;
      padding: 10px 20px;
      border-radius: 8px 8px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid #e0e0e0;
    }

    .tab-btn {
      padding: 10px 20px;
      background: transparent;
      border: none;
      border-radius: 5px 5px 0 0;
      font-size: 14px;
      font-weight: 500;
      color: #666;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tab-btn:hover {
      background: #f5f7fa;
      color: #333;
    }

    .tab-btn.active {
      background: #667eea;
      color: white;
      font-weight: 600;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .refresh-btn {
      padding: 8px 16px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .refresh-btn:hover {
      background: #218838;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .refresh-btn:active {
      transform: translateY(0);
    }

    /* ========================================
       ì•ˆë‚´ ë©”ì‹œì§€ ë°°ë„ˆ
       ======================================== */
    .info-banner {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      border-left: 4px solid #2196f3;
      padding: 12px 20px;
      margin-bottom: 10px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .info-content {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .info-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .info-text {
      font-size: 13px;
      color: #1565c0;
      line-height: 1.5;
    }

    .info-text strong {
      color: #0d47a1;
      font-weight: 600;
    }

    /* ========================================
       ëŒ€ì‹œë³´ë“œ íŒ¨ë„
       ======================================== */
    .dashboard-container {
      background: white;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      overflow: hidden;
    }

    .dashboard-panel {
      display: none;
    }

    .dashboard-panel.active {
      display: block;
    }

    .dashboard-panel iframe {
      width: 100%;
      height: 900px;
      border: none;
    }

    /* ========================================
       ë°ì´í„° ê·¸ë¦¬ë“œ
       ======================================== */
    .grid-section {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .grid-header {
      padding: 20px;
      border-bottom: 2px solid #f0f0f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .grid-header h2 {
      font-size: 18px;
      color: #333;
    }

    .grid-header h2 span {
      color: #667eea;
      font-weight: 700;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 40px;
      color: #999;
    }

    .loading.active {
      display: block;
    }

    .table-wrapper {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1400px;
    }

    th, td {
      padding: 14px 12px;
      text-align: left;
      border-bottom: 1px solid #f0f0f0;
      font-size: 13px;
    }

    th {
      background: #fafbfc;
      font-weight: 600;
      color: #555;
      white-space: nowrap;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    tbody tr {
      transition: background 0.2s;
    }

    tbody tr:hover {
      background: #f8f9fa;
      cursor: pointer;
    }

    td {
      color: #333;
    }

    td.ellipsis {
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* ========================================
       í˜ì´ì§€ë„¤ì´ì…˜
       ======================================== */
    .pagination {
      text-align: center;
      padding: 20px;
      background: white;
      border-top: 1px solid #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
    }

    .pagination button {
      padding: 8px 16px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .pagination button:hover:not(:disabled) {
      background: #f0f0f0;
      border-color: #667eea;
    }

    .pagination button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .pagination span {
      font-weight: 600;
      color: #333;
    }

    /* ========================================
       ëª¨ë‹¬
       ======================================== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      /* background: rgba(0,0,0,0.6); */
      z-index: 1000;
      animation: fadeIn 0.2s;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      max-width: 900px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .modal-header {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 24px;
      color: #333;
      border-bottom: 2px solid #667eea;
      padding-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-field {
      margin-bottom: 18px;
    }

    .modal-field label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
      font-size: 14px;
    }

    .modal-field label .required {
      color: red;
      margin-left: 4px;
    }

    .modal-field input,
    .modal-field textarea,
    .modal-field select {
      width: 100%;
      padding: 11px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    .modal-field input:focus,
    .modal-field textarea:focus,
    .modal-field select:focus {
      outline: none;
      border-color: #667eea;
    }

    .modal-field textarea {
      min-height: 90px;
      resize: vertical;
    }

    .modal-field input:disabled {
      background: #f5f5f5;
      color: #999;
      cursor: not-allowed;
    }

    .modal-buttons {
      margin-top: 24px;
      text-align: right;
      border-top: 1px solid #eee;
      padding-top: 20px;
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    .btn-cancel {
      background: #6c757d;
    }

    .btn-cancel:hover {
      background: #5a6268;
    }

    /* ========================================
       ë±ƒì§€
       ======================================== */
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-open {
      background: #e3f2fd;
      color: #1976d2;
    }

    .badge-in-progress {
      background: #fff3e0;
      color: #f57c00;
    }

    .badge-closed {
      background: #e8f5e9;
      color: #388e3c;
    }

    .badge-low {
      background: #e8f5e9;
      color: #388e3c;
    }

    .badge-medium {
      background: #fff3e0;
      color: #f57c00;
    }

    .badge-high {
      background: #ffebee;
      color: #d32f2f;
    }

    .badge-urgent {
      background: #f3e5f5;
      color: #7b1fa2;
    }

    .badge-latest {
      background: #4caf50;
      color: white;
      margin-left: 8px;
    }

    /* ========================================
       ì´ë ¥ ë²„íŠ¼
       ======================================== */
    .history-btn {
      padding: 6px 12px;
      background: #2196f3;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .history-btn:hover {
      background: #1976d2;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* ========================================
       ì´ë ¥ íƒ€ì„ë¼ì¸
       ======================================== */
    .history-timeline {
      padding: 10px;
    }

    .history-item {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      transition: all 0.2s;
    }

    .history-item:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-color: #2196f3;
    }

    .history-item.latest {
      border: 2px solid #4caf50;
      background: #f1f8f4;
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e0e0e0;
    }

    .history-date {
      font-size: 13px;
      color: #666;
      font-weight: 500;
    }

    .history-user {
      font-size: 13px;
      color: #2196f3;
      font-weight: 600;
    }

    .history-memo {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 10px;
      margin-bottom: 12px;
      font-size: 13px;
      border-radius: 4px;
    }

    .history-changes {
      margin-top: 12px;
      overflow-x: auto;
    }

    .history-changes-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      table-layout: fixed;
    }

    .history-changes-table th,
    .history-changes-table td {
      padding: 8px;
      border: 1px solid #e0e0e0;
      text-align: left;
      word-wrap: break-word;
      word-break: break-word;
      overflow-wrap: break-word;
    }

    .history-changes-table th {
      background: #f5f5f5;
      font-weight: 600;
    }

    .history-changes-table th:first-child {
      width: 25%;
    }

    .history-changes-table th:nth-child(2) {
      width: 37.5%;
    }

    .history-changes-table th:nth-child(3) {
      width: 37.5%;
    }

    /* 2ì»¬ëŸ¼ í…Œì´ë¸” (ìµœì´ˆ ë“±ë¡) */
    .history-changes-table th:first-child:last-child {
      width: 30%;
    }

    .old-value {
      color: #f44336;
      text-decoration: line-through;
      background: #ffebee;
    }

    .new-value {
      color: #4caf50;
      font-weight: 600;
      background: #e8f5e9;
    }

    .modal-close {
      background: transparent;
      border: none;
      font-size: 28px;
      color: #999;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      line-height: 1;
    }

    .modal-close:hover {
      color: #333;
    }
  </style>

  <!-- Keycloak ì œê±°: ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” Basic Auth ì‚¬ìš© -->
</head>
<body>
  <div class="container">
    <!-- í—¤ë” -->
    <div class="header">
      <h1>[v7] CS ìƒë‹´ í†µí•© ëŒ€ì‹œë³´ë“œ</h1>
      <p>ì£¼ë³„ ë¶„ì„ ë° ì¼ë³„/ì‹œê°„ë³„ ìƒë‹´ ë°ì´í„° ì¡°íšŒ Â· ìˆ˜ì •</p>
    </div>

    <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="tabs">
      <div style="display: flex; gap: 10px;">
        <button class="tab-btn active" onclick="switchTab('case1')">ğŸ“ˆ ì£¼ë³„ ëŒ€ì‹œë³´ë“œ</button>
        <button class="tab-btn" onclick="switchTab('case2')">ğŸ“… ì¼ë³„/ì‹œê°„ë³„ ëŒ€ì‹œë³´ë“œ</button>
        <button class="tab-btn" onclick="switchTab('case3')">ğŸ“‹ ë°ì´í„° ëª©ë¡</button>
      </div>
    </div>

    <!-- Case 1: ì£¼ë³„ ëŒ€ì‹œë³´ë“œ -->
    <div id="tab-case1" class="tab-content active">
      <!-- í•„í„° ì˜ì—­ -->
      <div class="filter-section">
      <div class="filter-title">ğŸ” í•„í„°</div>

      <!-- ë‚ ì§œ í•„í„° -->
      <div class="filter-controls">
        <div class="filter-group">
          <label>ì‹œì‘ì¼</label>
          <input type="datetime-local" id="dateFrom" value="2025-12-01T00:00">
        </div>
        <div class="filter-group">
          <label>ì¢…ë£Œì¼</label>
          <input type="datetime-local" id="dateTo" value="2025-12-31T23:59">
        </div>
        <button class="btn" onclick="applyFilters()" style="padding: 10px 40px;">ì¡°íšŒ</button>
      </div>
    </div>

      <!-- ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ -->
      <div style="text-align: right; margin-bottom: 10px;">
        <button class="refresh-btn" onclick="refreshDashboards()" title="ëŒ€ì‹œë³´ë“œë¥¼ HTML í•„í„° ê¸°ì¤€ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨">
          ğŸ”„ ëŒ€ì‹œë³´ë“œ ìƒˆë¡œê³ ì¹¨
        </button>
      </div>

      <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
      <div class="info-banner">
        <div class="info-content">
          <span class="info-icon">â„¹ï¸</span>
          <span class="info-text">
            <strong>ëŒ€ì‹œë³´ë“œ ì¸í„°ë™ì…˜ ì•ˆë‚´:</strong>
            ëŒ€ì‹œë³´ë“œ ë‚´ì—ì„œ ì°¨íŠ¸ë¥¼ í´ë¦­í•˜ê±°ë‚˜ Time Rangeë¥¼ ë³€ê²½í•˜ë©´ ìœ„ì˜ HTML í•„í„°ì™€ ë™ê¸°í™”ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            ì›ë˜ í•„í„° ê¸°ì¤€ìœ¼ë¡œ ë˜ëŒë¦¬ë ¤ë©´ <strong>ğŸ”„ ìƒˆë¡œê³ ì¹¨</strong> ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
          </span>
        </div>
      </div>

      <!-- ëŒ€ì‹œë³´ë“œ iframe -->
      <div class="dashboard-container">
        <iframe id="iframe-case1" src="" style="width: 100%; height: 900px; border: none; background: white;"></iframe>
      </div>
    </div>

    <!-- Case 2: ì¼ë³„/ì‹œê°„ë³„ ëŒ€ì‹œë³´ë“œ -->
    <div id="tab-case2" class="tab-content">
      <!-- í•„í„° ì˜ì—­ -->
      <div class="filter-section">
        <div class="filter-title">ğŸ” í•„í„°</div>

        <!-- ë‚ ì§œ í•„í„° -->
        <div class="filter-controls">
          <div class="filter-group">
            <label>ì‹œì‘ì¼</label>
            <input type="datetime-local" id="dateFrom2" value="2025-12-01T00:00">
          </div>
          <div class="filter-group">
            <label>ì¢…ë£Œì¼</label>
            <input type="datetime-local" id="dateTo2" value="2025-12-31T23:59">
          </div>
          <button class="btn" onclick="applyFilters()" style="padding: 10px 40px;">ì¡°íšŒ</button>
        </div>
      </div>

      <!-- ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ -->
      <div style="text-align: right; margin-bottom: 10px;">
        <button class="refresh-btn" onclick="refreshDashboards()" title="ëŒ€ì‹œë³´ë“œë¥¼ HTML í•„í„° ê¸°ì¤€ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨">
          ğŸ”„ ëŒ€ì‹œë³´ë“œ ìƒˆë¡œê³ ì¹¨
        </button>
      </div>

      <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
      <div class="info-banner">
        <div class="info-content">
          <span class="info-icon">â„¹ï¸</span>
          <span class="info-text">
            <strong>ëŒ€ì‹œë³´ë“œ ì¸í„°ë™ì…˜ ì•ˆë‚´:</strong>
            ëŒ€ì‹œë³´ë“œ ë‚´ì—ì„œ ì°¨íŠ¸ë¥¼ í´ë¦­í•˜ê±°ë‚˜ Time Rangeë¥¼ ë³€ê²½í•˜ë©´ ìœ„ì˜ HTML í•„í„°ì™€ ë™ê¸°í™”ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            ì›ë˜ í•„í„° ê¸°ì¤€ìœ¼ë¡œ ë˜ëŒë¦¬ë ¤ë©´ <strong>ğŸ”„ ìƒˆë¡œê³ ì¹¨</strong> ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
          </span>
        </div>
      </div>

      <!-- ëŒ€ì‹œë³´ë“œ iframe -->
      <div class="dashboard-container">
        <iframe id="iframe-case2" src="" style="width: 100%; height: 900px; border: none; background: white;"></iframe>
      </div>
    </div>

    <!-- Case 3: ë°ì´í„° ëª©ë¡ -->
    <div id="tab-case3" class="tab-content">
      <!-- í•„í„° ì˜ì—­ (ë³µì œ) -->
      <div class="filter-section">
        <div class="filter-title">ğŸ” í•„í„°</div>

        <!-- ì²« ë²ˆì§¸ ì¤„: ë‚ ì§œ ë° ì—ì´ì „íŠ¸ -->
        <div class="filter-controls">
          <div class="filter-group">
            <label>ì‹œì‘ì¼</label>
            <input type="datetime-local" id="dateFrom3" value="2025-12-01T00:00">
          </div>
          <div class="filter-group">
            <label>ì¢…ë£Œì¼</label>
            <input type="datetime-local" id="dateTo3" value="2025-12-31T23:59">
          </div>
          <div class="filter-group">
            <label>ì—ì´ì „íŠ¸ ID</label>
            <select id="agentFilter3">
              <option value="">ì „ì²´</option>
            </select>
          </div>
        </div>

        <!-- ë‘ ë²ˆì§¸ ì¤„: ì¹´í…Œê³ ë¦¬ -->
        <div class="filter-controls">
          <div class="filter-group">
            <label>ëŒ€ë¶„ë¥˜</label>
            <select id="categoryLargeFilter3" onchange="onCategoryLargeChange3()">
              <option value="">ì „ì²´</option>
            </select>
          </div>
          <div class="filter-group">
            <label>ì¤‘ë¶„ë¥˜</label>
            <select id="categoryMediumFilter3" onchange="onCategoryMediumChange3()" disabled>
              <option value="">ì „ì²´</option>
            </select>
          </div>
          <div class="filter-group">
            <label>ì†Œë¶„ë¥˜</label>
            <select id="categorySmallFilter3" disabled>
              <option value="">ì „ì²´</option>
            </select>
          </div>
        </div>

        <!-- ì„¸ ë²ˆì§¸ ì¤„: ìƒíƒœ ë° ìš°ì„ ìˆœìœ„ -->
        <div class="filter-controls">
          <div class="filter-group">
            <label>ìƒíƒœ</label>
            <select id="statusFilter3">
              <option value="">ì „ì²´</option>
              <option value="OPEN">ì—´ë¦¼</option>
              <option value="ON_HOLD">ëŒ€ê¸°ì¤‘</option>
              <option value="CLOSED">ì¢…ë£Œ</option>
            </select>
          </div>
          <div class="filter-group">
            <label>ìš°ì„ ìˆœìœ„</label>
            <select id="priorityFilter3">
              <option value="">ì „ì²´</option>
              <option value="LOW">ë‚®ìŒ</option>
              <option value="MEDIUM">ë³´í†µ</option>
              <option value="HIGH">ë†’ìŒ</option>
              <option value="URGENT">ê¸´ê¸‰</option>
            </select>
          </div>
        </div>

        <!-- ë„¤ ë²ˆì§¸ ì¤„: í‚¤ì›Œë“œ ê²€ìƒ‰ -->
        <div class="filter-controls">
          <div class="filter-group" style="flex: 1;">
            <label>ì‚¬ìš©ì ìš”ì•½ í‚¤ì›Œë“œ</label>
            <input type="text" id="userSummaryFilter3" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">
          </div>
          <div class="filter-group" style="flex: 1;">
            <label>ì–´ì‹œìŠ¤í„´íŠ¸ ìš”ì•½ í‚¤ì›Œë“œ</label>
            <input type="text" id="assistantSummaryFilter3" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">
          </div>
        </div>

        <!-- ë‹¤ì„¯ ë²ˆì§¸ ì¤„: ì¡°íšŒ ë²„íŠ¼ -->
        <div class="filter-controls">
          <button class="btn" onclick="applyFilters()" style="padding: 10px 40px;">ì¡°íšŒ</button>
        </div>
      </div>

      <!-- ë°ì´í„° ê·¸ë¦¬ë“œ -->
      <div class="grid-section">
      <div class="grid-header">
        <h2>ë°ì´í„° ëª©ë¡ (<span id="totalCount">0</span>ê±´)</h2>
      </div>

      <div class="loading" id="loadingIndicator">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

      <div class="table-wrapper">
        <table id="dataGrid">
          <thead>
            <tr>
              <th>íƒ€ì„ìŠ¤íƒ¬í”„</th>
              <th>ì„¸ì…˜ ID</th>
              <th>ëŒ€ë¶„ë¥˜</th>
              <th>ì¤‘ë¶„ë¥˜</th>
              <th>ì†Œë¶„ë¥˜</th>
              <th>ì‚¬ìš©ì ìš”ì•½</th>
              <th>ì–´ì‹œìŠ¤í„´íŠ¸ ìš”ì•½</th>
              <th>ìƒíƒœ</th>
              <th>ìš°ì„ ìˆœìœ„</th>
              <th>ì´ë ¥</th>
            </tr>
          </thead>
          <tbody id="gridBody">
            <!-- ë™ì  ë Œë”ë§ -->
          </tbody>
        </table>
      </div>

      <div class="pagination">
        <button onclick="prevPage()" id="prevBtn">&lt; ì´ì „</button>
        <span id="pageInfo">1 / 1</span>
        <button onclick="nextPage()" id="nextBtn">ë‹¤ìŒ &gt;</button>
      </div>
    </div>
    </div>
  </div>

  <!-- ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">ë°ì´í„° ìˆ˜ì •</div>

      <div class="modal-field">
        <label>ì„¸ì…˜ ID</label>
        <input type="text" id="modal_session_id" disabled>
      </div>

      <div class="modal-field">
        <label>ì‚¬ìš©ì ìš”ì•½ (user_summary)</label>
        <textarea id="modal_user_summary"></textarea>
      </div>

      <div class="modal-field">
        <label>ì–´ì‹œìŠ¤í„´íŠ¸ ìš”ì•½ (assistant_summary)</label>
        <textarea id="modal_assistant_summary"></textarea>
      </div>

      <div class="modal-field">
        <label>ëŒ€ë¶„ë¥˜ ì½”ë“œ (category_code)</label>
        <input type="text" id="modal_category_code" placeholder="ì˜ˆ: A-01">
      </div>

      <div class="modal-field">
        <label>ëŒ€ë¶„ë¥˜ (category_large)</label>
        <input type="text" id="modal_category_large" placeholder="ì˜ˆ: A">
      </div>

      <div class="modal-field">
        <label>ì¤‘ë¶„ë¥˜ (category_medium)</label>
        <input type="text" id="modal_category_medium" placeholder="ì˜ˆ: 01">
      </div>

      <div class="modal-field">
        <label>ì†Œë¶„ë¥˜ (category_small)</label>
        <input type="text" id="modal_category_small" placeholder="ì„ íƒì‚¬í•­">
      </div>

      <div class="modal-field">
        <label>ì§€ì› ìƒíƒœ (support_status)</label>
        <select id="modal_support_status">
          <option value="OPEN">OPEN</option>
          <option value="IN_PROGRESS">IN_PROGRESS</option>
          <option value="CLOSED">CLOSED</option>
        </select>
      </div>

      <div class="modal-field">
        <label>ìš°ì„ ìˆœìœ„ (support_priority)</label>
        <select id="modal_support_priority">
          <option value="LOW">LOW</option>
          <option value="MEDIUM">MEDIUM</option>
          <option value="HIGH">HIGH</option>
          <option value="URGENT">URGENT</option>
        </select>
      </div>

      <div class="modal-field">
        <label>ìˆ˜ì • ì‚¬ìœ <span class="required">*</span></label>
        <textarea id="modal_memo" placeholder="ìˆ˜ì • ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" required></textarea>
      </div>

      <div class="modal-buttons">
        <button class="btn btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
        <button class="btn" onclick="saveChanges()">ì €ì¥</button>
      </div>
    </div>
  </div>

  <!-- ì´ë ¥ ëª¨ë‹¬ -->
  <div id="historyModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        ìˆ˜ì • ì´ë ¥
        <button class="modal-close" onclick="closeHistoryModal()">&times;</button>
      </div>

      <div id="historyContent" style="max-height: 500px; overflow-y: auto;">
        <!-- ë™ì  ë Œë”ë§ -->
      </div>

      <div class="modal-buttons">
        <button class="btn btn-cancel" onclick="closeHistoryModal()">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <script>
    // ====================================================================
    // ì„¤ì • (ë¡œì»¬ í™˜ê²½ - Basic Auth)
    // ====================================================================
    const OPENSEARCH_URL = 'https://opensearch-stage.hecto.co.kr';
    const DASHBOARD_URL = 'http://localhost:5601';
    const INDEX_PATTERN = 'agent_dashboard_stage_30573970fd8d4701b23f7727b73aa099';
    const TENANT = '30573970fd8d4701b23f7727b73aa099-stage';  // í…Œë„ŒíŠ¸ (í•„ìš”ì‹œ ìˆ˜ì •)

    // Basic Auth ì„¤ì •
    const USE_BASIC_AUTH = true;  // ë¡œì»¬ì€ Basic Auth ì‚¬ìš©
    const OPENSEARCH_BASIC_USER = 'admin';
    const OPENSEARCH_BASIC_PASS = 'admin';

    const DASHBOARD_IDS = {
      case1: 'v7_cs_summary_weekly_dashboard',
      case2: 'v7_cs_daily_hourly_dashboard'
    };

    // ì¹´í…Œê³ ë¦¬ ê³„ì¸µ êµ¬ì¡° (CSV ë°ì´í„° ê¸°ë°˜)
    const CATEGORY_HIERARCHY = {
      "A": { name: "íšŒì›", medium: { "10": { name: "ê°€ì…/íƒˆí‡´", small: {"1": "íšŒì› ê°€ì…", "2": "íšŒì› íƒˆí‡´"} }, "20": { name: "ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ", small: {} }, "30": { name: "ê°œì¸ì •ë³´ë³€ê²½", small: {} }, "40": { name: "ë§ˆì¼€íŒ… ìˆ˜ì‹  ì„¤ì •", small: {} }, "99": { name: "ê¸°íƒ€ íšŒì› ê´€ë ¨", small: {} } } },
      "B": { name: "ì œí’ˆ", medium: { "10": { name: "ì œí’ˆ ê¸°ë³¸ ì •ë³´", small: {"1": "ì œí’ˆ ê¸°ë³¸ ì •ë³´", "2": "ì œí’ˆ ì„±ë¶„", "3": "ì œí’ˆ í•¨ëŸ‰/ìš©ëŸ‰", "4": "ì œí’ˆ ê¸°ëŠ¥/íš¨ê³¼", "5": "ì œí’ˆ ìœ í†µ ê¸°í•œ", "6": "ì œí’ˆ ë³´ê´€ ë°©ë²•", "7": "ì œí’ˆ ì œí˜•", "99": "ê¸°íƒ€ ì œí’ˆ ì •ë³´ ê´€ë ¨"} }, "20": { name: "ì„­ì·¨ ì•ˆë‚´", small: {"1": "ì œí’ˆ ì„­ì·¨ ëŒ€ìƒ(ì„­ì·¨ ì „)", "2": "ì œí’ˆ ì„­ì·¨ ë°©ë²•", "3": "ì œí’ˆ ì•Œë ˆë¥´ê¸°/ì£¼ì˜ì‚¬í•­(ì„­ì·¨ ì „)", "99": "ê¸°íƒ€ ì„­ì·¨ ê´€ë ¨"} }, "30": { name: "ì„­ì·¨ í›„ ì¦ìƒ/ë°˜ì‘", small: {"1": "ì†Œí™”ê¸° ì¦ìƒ", "99": "ê¸°íƒ€ ì„­ì·¨ í›„ ë°˜ì‘"} }, "40": { name: "ìƒí’ˆ ì¶”ì²œ/ë¹„êµ", small: {"1": "ì—°ë ¹ë³„ ìƒí’ˆ ì¶”ì²œ", "2": "ì¦ìƒë³„ ìƒí’ˆ ì¶”ì²œ", "3": "ëª©ì ë³„ ìƒí’ˆ ì¶”ì²œ", "4": "ì„±ë¶„ë³„ ìƒí’ˆ ì¶”ì²œ", "50": "ìƒí’ˆ ë¹„êµ", "99": "ê¸°íƒ€ ì¶”ì²œ ê´€ë ¨"} }, "99": { name: "ê¸°íƒ€ ì œí’ˆ ê´€ë ¨", small: {} } } },
      "C": { name: "ì œí’ˆ ë¶ˆëŸ‰/í’ˆì§ˆ ì´ìŠˆ", medium: { "10": { name: "ì œí’ˆ í’ˆì§ˆ ì´ìƒ(ë³€ì§ˆ)", small: {} }, "20": { name: "ì œí’ˆ ë‚´ ì´ë¬¼ì§ˆ", small: {} }, "30": { name: "ì œí’ˆ ì œì¡° ë¶ˆëŸ‰", small: {} }, "99": { name: "ê¸°íƒ€ ì œí’ˆ ë¶ˆëŸ‰/í’ˆì§ˆ ì´ìŠˆ", small: {} } } },
      "D": { name: "êµ¬ë§¤", medium: { "10": { name: "ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ êµ¬ë§¤", small: {} }, "20": { name: "ì¬ê³ /í’ˆì ˆ", small: {} }, "99": { name: "ê¸°íƒ€ êµ¬ë§¤ ê´€ë ¨", small: {} } } },
      "E": { name: "ê²°ì œ", medium: { "10": { name: "ê²°ì œ ìˆ˜ë‹¨ ë³€ê²½", small: {} }, "20": { name: "ì§€ì¶œ ì¦ë¹™", small: {} }, "30": { name: "ì¼ë°˜ ê²°ì œ ì˜¤ë¥˜", small: {} }, "99": { name: "ê¸°íƒ€ ì¼ë°˜ ê²°ì œ ê´€ë ¨", small: {} } } },
      "F": { name: "ì£¼ë¬¸ ê´€ë¦¬", medium: { "10": { name: "ì£¼ë¬¸ ì¡°íšŒ", small: {} }, "20": { name: "ì£¼ë¬¸ ì·¨ì†Œ(ê²°ì œ ì „)", small: {} }, "30": { name: "ê²°ì œ ì·¨ì†Œ(ê²°ì œ í›„, ë°°ì†¡ ì „)", small: {} }, "40": { name: "ë°˜í’ˆ/êµí™˜(ë°°ì†¡ ì™„ë£Œ í›„)", small: {} }, "99": { name: "ê¸°íƒ€ ì£¼ë¬¸ ê´€ë ¨", small: {} } } },
      "G": { name: "ì¼ë°˜ ë°°ì†¡", medium: { "10": { name: "ë°°ì†¡ ì •ì±…", small: {} }, "20": { name: "ë°°ì†¡ ì¡°íšŒ/ì¶”ì ", small: {} }, "30": { name: "ë°°ì†¡ ì£¼ì†Œ/ë©”ì‹œì§€ ë³€ê²½", small: {} }, "40": { name: "ë°°ì†¡ ì§€ì—°", small: {} }, "50": { name: "ë°°ì†¡ íŒŒì†/ì†ìƒ(ë°°ì†¡ ì¤‘ ì›ì¸ ê´€ë ¨)", small: {} }, "60": { name: "ë°°ì†¡ ëˆ„ë½", small: {} }, "99": { name: "ê¸°íƒ€ ë°°ì†¡ ê´€ë ¨", small: {} } } },
      "H": { name: "ì •ê¸° êµ¬ë…(ë˜ë°•ë°°ì†¡)", medium: { "10": { name: "êµ¬ë… í˜œíƒ/ì‹ ì²­", small: {"1": "êµ¬ë… í˜œíƒ", "2": "êµ¬ë… ì‹ ì²­", "99": "ê¸°íƒ€ êµ¬ë… í˜œíƒ/ì‹ ì²­ ê´€ë ¨"} }, "20": { name: "êµ¬ë… ì •ì±…", small: {} }, "30": { name: "êµ¬ë… ë³€ê²½", small: {"1": "êµ¬ë… ê±´ë„ˆë›°ê¸°", "2": "êµ¬ë… ìƒí’ˆ ë³€ê²½", "99": "ê¸°íƒ€ êµ¬ë… ë³€ê²½ ê´€ë ¨"} }, "40": { name: "êµ¬ë… ê²°ì œ", small: {"1": "êµ¬ë… ê²°ì œ ìˆ˜ë‹¨ ë³€ê²½", "2": "êµ¬ë… ê²°ì œì¼ ë³€ê²½", "3": "êµ¬ë… ê²°ì œ ì·¨ì†Œ", "4": "êµ¬ë… ê²°ì œ ì˜¤ë¥˜", "99": "ê¸°íƒ€ êµ¬ë… ê²°ì œ ê´€ë ¨"} }, "50": { name: "êµ¬ë… ë°°ì†¡", small: {"1": "êµ¬ë… ë°°ì†¡ ì •ì±…", "2": "êµ¬ë… ë°°ì†¡ ì¡°íšŒ/ì¶”ì ", "3": "êµ¬ë… ë°°ì†¡ ì£¼ì†Œ/ë©”ì‹œì§€ ë³€ê²½", "4": "êµ¬ë… ë°°ì†¡ ì§€ì—°", "5": "êµ¬ë… ë°°ì†¡ íŒŒì†/ì†ìƒ(ë°°ì†¡ ì¤‘ ì›ì¸ ê´€ë ¨)", "6": "êµ¬ë… ë°°ì†¡ ëˆ„ë½", "7": "í•© ë°°ì†¡ ê´€ë ¨", "99": "ê¸°íƒ€ êµ¬ë… ë°°ì†¡ ê´€ë ¨"} }, "90": { name: "êµ¬ë… í•´ì§€", small: {"1": "êµ¬ë… í•´ì§€ ì •ì±…", "2": "êµ¬ë… í•´ì§€ ìœ„ì•½ê¸ˆ", "99": "ê¸°íƒ€ êµ¬ë… í•´ì§€ ê´€ë ¨ ë¬¸ì˜"} }, "99": { name: "ê¸°íƒ€ ì •ê¸° êµ¬ë… ê´€ë ¨", small: {} } } },
      "I": { name: "ë©¤ë²„ì‹­/ë¦¬ì›Œë“œ í˜œíƒ", medium: { "10": { name: "ê°€ì… í˜œíƒ(ê°€ì… ì „)", small: {} }, "20": { name: "ë©¤ë²„ì‹­ í˜œíƒ(ê°€ì… í›„)", small: {} }, "30": { name: "í¬ì¸íŠ¸/ì ë¦½ê¸ˆ", small: {} }, "40": { name: "ì¿ í°", small: {} }, "50": { name: "í¬ì¸íŠ¸ êµí™˜/ì‘ëª¨", small: {} }, "99": { name: "ê¸°íƒ€ ë©¤ë²„ì‹­/í˜œíƒ ê´€ë ¨", small: {} } } },
      "J": { name: "ì´ë²¤íŠ¸(í”„ë¡œëª¨ì…˜)/ì‚¬ì€í’ˆ", medium: { "10": { name: "ì´ë²¤íŠ¸/í”„ë¡œëª¨ì…˜ ë¬¸ì˜", small: {} }, "20": { name: "ì‚¬ì€í’ˆ ë¬¸ì˜", small: {} }, "99": { name: "ê¸°íƒ€ ì´ë²¤íŠ¸/í”„ë¡œëª¨ì…˜/ì‚¬ì€í’ˆ ê´€ë ¨", small: {} } } },
      "K": { name: "í™ˆí˜ì´ì§€/ì•±", medium: { "10": { name: "ì„œë¹„ìŠ¤ ê¸°ëŠ¥", small: {"1": "ì„­ì·¨ ì•Œë¦¼ ê¸°ëŠ¥(ì•±)", "2": "ì˜ì–‘ì œ ë¶„ì„/ì„¤ê³„ ê¸°ëŠ¥(ì•±)", "3": "í¬ì¸íŠ¸ êµí™˜ì†Œ ê¸°ëŠ¥(ì•±)", "4": "êµ¬ë§¤ í›„ê¸°/ë¦¬ë·°", "5": "AIì±—ë´‡", "99": "ê¸°íƒ€ ì„œë¹„ìŠ¤ ê¸°ëŠ¥"} }, "20": { name: "ì •ì±…/ì•½ê´€", small: {} }, "99": { name: "ê¸°íƒ€ í™ˆí˜ì´ì§€ ì›¹/ì•± ê´€ë ¨", small: {} } } },
      "L": { name: "ì‹œìŠ¤í…œ ì˜¤ë¥˜", medium: { "99": { name: "ê¸°íƒ€ ì‹œìŠ¤í…œ ì˜¤ë¥˜/ë²„ê·¸ ê´€ë ¨", small: {} } } },
      "M": { name: "í”¼ë“œë°±/ì œì•ˆ", medium: { "10": { name: "ê°œì„  ì˜ê²¬", small: {} }, "20": { name: "ë¶ˆë§Œ", small: {} }, "30": { name: "ì¹­ì°¬", small: {} }, "99": { name: "ê¸°íƒ€ í”¼ë“œë°±/ì œì•ˆ ê´€ë ¨", small: {} } } },
      "N": { name: "ê³ ê°ì„¼í„°", medium: { "10": { name: "ìƒë‹´ ìš”ì²­/ì·¨ì†Œ", small: {} }, "99": { name: "ê¸°íƒ€ ê³ ê°ì„¼í„° ê´€ë ¨", small: {} } } },
      "O": { name: "B2B/ì œíœ´", medium: { "10": { name: "ì•½êµ­", small: {} }, "20": { name: "ê¸°ì—…/ë‹¨ì²´", small: {} }, "30": { name: "ì œíœ´/í˜‘ì°¬", small: {} }, "99": { name: "ê¸°íƒ€ B2B ê´€ë ¨", small: {} } } },
      "Z": { name: "ê¸°íƒ€", medium: { "99": { name: "ê¸°íƒ€ ë¯¸ë¶„ë¥˜", small: {} } } }
    };

    // ====================================================================
    // ì „ì—­ ë³€ìˆ˜
    // ====================================================================
    let currentData = [];
    let selectedDoc = null;
    let currentPage = 0;
    const pageSize = 20;
    let totalCount = 0;
    let currentTab = 'case1';

    // íƒ­ë³„ ë¡œë“œ ìƒíƒœ ì¶”ì  (ìµœì´ˆ í´ë¦­ ì‹œì—ë§Œ ì¡°íšŒ)
    const tabLoaded = {
      case1: false,
      case2: false,
      case3: false
    };

    // ====================================================================
    // í•˜ë“œì½”ë”©ëœ ìƒ˜í”Œ ë°ì´í„° (CORS ë¬¸ì œ íšŒí”¼ìš©)
    // ====================================================================
    const MOCK_DATA = [
      {
        "_id": "kTfHRZwB49yqHgXDilNq",
        "_source": {
          "@timestamp": "2026-02-03T14:28:22.049Z",
          "agent_id": "4ede8d78a06449a3a21f6ce616207e9e",
          "agent_name": "ğŸŸª[HH][ë“œì‹œëª¨ë„¤ëª°] ê³ ê° ì§ˆì˜ë‹µë³€ ì—ì´ì „íŠ¸ (v1.1.4)",
          "session_id": "417787f5ca334a13b402a3cc8f285e16",
          "dashboard": {
            "support_priority_keyword": "LOW",
            "category_large_code_keyword": "A",
            "category_medium_code_keyword": "99",
            "category_small_code_keyword": null,
            "category_code_keyword": "A-99",
            "category_large_name_keyword": "íšŒì›",
            "category_medium_name_keyword": "ê¸°íƒ€ íšŒì› ê´€ë ¨",
            "category_small_name_keyword": null,
            "user_summary_search": "ëª‡ ë…„ ì „ ê°€ì…í•´ êµ¬ì…í•œ ì´ë ¥ ê´€ë ¨ ë‚´ìš© ì–¸ê¸‰ (êµ¬ì²´ ë¬¸ì˜ ë‚´ìš© ë¶ˆëª…í™•)!",
            "assistant_summary_search": "ê³¼ê±° ì´ë ¥ ë“±ì€ ì±—ë´‡ì—ì„œ ë°”ë¡œ ì•ˆë‚´ ë¶ˆê°€í•˜ë©° í‰ì¼ 8ì‹œ~17ì‹œ ê³ ê°ì„¼í„°(â˜1688-8211)ë¡œ ë¬¸ì˜í•˜ë¼ëŠ” ì•ˆë‚´",
            "support_status_keyword": "OPEN",
            "memo_hist": [
              {
                "before": null,
                "memo": "ai ìµœì´ˆë“±ë¡",
                "created_at": "2026-02-10T04:20:30Z",
                "after": {
                  "assistant_summary": "ê³¼ê±° ì´ë ¥ ë“±ì€ ì±—ë´‡ì—ì„œ ë°”ë¡œ ì•ˆë‚´ ë¶ˆê°€í•˜ë©° í‰ì¼ 8ì‹œ~17ì‹œ ê³ ê°ì„¼í„°(â˜1688-8211)ë¡œ ë¬¸ì˜í•˜ë¼ëŠ” ì•ˆë‚´",
                  "support_status": "NEW",
                  "user_summary": "ëª‡ ë…„ ì „ ê°€ì…í•´ êµ¬ì…í•œ ì´ë ¥ ê´€ë ¨ ë‚´ìš© ì–¸ê¸‰ (êµ¬ì²´ ë¬¸ì˜ ë‚´ìš© ë¶ˆëª…í™•)",
                  "category_code": "A-99",
                  "support_priority": "",
                  "category_large": "A",
                  "category_medium": "99",
                  "category_small": null
                },
                "created_by": "AI_SYSTEM"
              },
              {
                "before": {
                  "support_status": "NEW",
                  "support_priority": "",
                  "user_summary_search": "ëª‡ ë…„ ì „ ê°€ì…í•´ êµ¬ì…í•œ ì´ë ¥ ê´€ë ¨ ë‚´ìš© ì–¸ê¸‰ (êµ¬ì²´ ë¬¸ì˜ ë‚´ìš© ë¶ˆëª…í™•)"
                },
                "memo": "ì‚¬ìš©ì ìš”ì²­ ë‚´ìš©ì„ ìˆ˜ì •í•¨!",
                "created_at": "2026-02-11T01:17:28.574Z",
                "after": {
                  "support_status": "OPEN",
                  "support_priority": "LOW",
                  "user_summary_search": "ëª‡ ë…„ ì „ ê°€ì…í•´ êµ¬ì…í•œ ì´ë ¥ ê´€ë ¨ ë‚´ìš© ì–¸ê¸‰ (êµ¬ì²´ ë¬¸ì˜ ë‚´ìš© ë¶ˆëª…í™•)!"
                },
                "created_by": "mjk@hecto.co.kr"
              }
            ]
          }
        }
      },
      {
        "_id": "kjfIRZwB49yqHgXDDlQR",
        "_source": {
          "@timestamp": "2026-02-03T12:59:56.524Z",
          "agent_id": "4ede8d78a06449a3a21f6ce616207e9e",
          "agent_name": "ğŸŸª[HH][ë“œì‹œëª¨ë„¤ëª°] ê³ ê° ì§ˆì˜ë‹µë³€ ì—ì´ì „íŠ¸ (v1.1.4)",
          "session_id": "b9f7c025d09f48549bb26615c56d257e",
          "dashboard": {
            "support_priority_keyword": "",
            "category_large_code_keyword": "B",
            "category_medium_code_keyword": "40",
            "category_small_code_keyword": "2",
            "category_code_keyword": "B-40-2",
            "category_large_name_keyword": "ì œí’ˆ",
            "category_medium_name_keyword": "ìƒí’ˆ ì¶”ì²œ/ë¹„êµ",
            "category_small_name_keyword": "ì¦ìƒë³„ ìƒí’ˆ ì¶”ì²œ",
            "user_summary_search": "ì„±ì¸ ëˆˆì˜ì–‘ì œ êµ¬ì… ë¬¸ì˜",
            "assistant_summary_search": "ë˜ë°•ì¼€ì–´LAB ë£¨í…Œì¸ ë¹„íƒ€ë¯¼Aë¥¼ ì„±ì¸ ëˆˆ ê±´ê°•ìš© ì œí’ˆìœ¼ë¡œ ì•ˆë‚´í•˜ë©° ë£¨í…Œì¸ 20mg, ì•„ìŠ¤íƒ€ì”í‹´ 4mg, ë¹„íƒ€ë¯¼A 700Î¼gRAE, 60ìº¡ìŠ/2ê°œì›”ë¶„, ê°€ê²© 38,000ì›ê³¼ ê¸°ëŠ¥Â·ì„­ì·¨ ëŒ€ìƒÂ·ì£¼ì˜ì‚¬í•­ ë° ë“œì‹œëª¨ë„¤ëª° êµ¬ë§¤ ê°€ëŠ¥ ì—¬ë¶€ ì•ˆë‚´",
            "support_status_keyword": "NEW"
          }
        }
      },
      {
        "_id": "ojfGRZwB49yqHgXDYFEs",
        "_source": {
          "@timestamp": "2026-02-03T12:58:35.049Z",
          "agent_id": "4ede8d78a06449a3a21f6ce616207e9e",
          "agent_name": "ğŸŸª[HH][ë“œì‹œëª¨ë„¤ëª°] ê³ ê° ì§ˆì˜ë‹µë³€ ì—ì´ì „íŠ¸ (v1.1.4)",
          "session_id": "cf1094e345ad435b945ad626262c4819",
          "dashboard": {
            "support_priority_keyword": "",
            "category_large_code_keyword": "B",
            "category_medium_code_keyword": "10",
            "category_small_code_keyword": "2",
            "category_code_keyword": "B-10-2",
            "category_large_name_keyword": "ì œí’ˆ",
            "category_medium_name_keyword": "ì œí’ˆ ê¸°ë³¸ ì •ë³´",
            "category_small_name_keyword": "ì œí’ˆ ì„±ë¶„",
            "user_summary_search": "ë£¨í…Œì¸ ì§€ì•„ì”í‹´ ì„±ë¶„ì´ ì œí’ˆì—ì„œ ì—†ì–´ì¡ŒëŠ”ì§€ ë¬¸ì˜í•˜ê³ , í•´ë‹¹ ë£¨í…Œì¸ ì œí’ˆ êµ¬ë§¤ ë° íŒë§¤ í˜ì´ì§€ ì—°ê²° ìš”ì²­",
            "assistant_summary_search": "ë˜ë°•ì¼€ì–´LAB ë£¨í…Œì¸ ë¹„íƒ€ë¯¼A ì œí’ˆì´ íŒë§¤ ì¤‘ì´ë©° ë£¨í…Œì¸ 20mg, ë¹„íƒ€ë¯¼A 700Î¼gRAE, ì•„ìŠ¤íƒ€ì”í‹´ 4mg ë“±ì´ í•¨ìœ ëœ ê±´ê°•ê¸°ëŠ¥ì‹í’ˆì´ë¼ê³  ì•ˆë‚´í•˜ê³ , ë“œì‹œëª¨ë„¤ëª°ì—ì„œ êµ¬ë§¤ ê°€ëŠ¥í•˜ë©° ê°€ê²© 38,000ì›, 1ì¼ 1ì •, 60ìº¡ìŠ(2ê°œì›”ë¶„) êµ¬ì„± ë° ì„­ì·¨ ëŒ€ìƒÂ·ì£¼ì˜ì‚¬í•­ ì•ˆë‚´",
            "support_status_keyword": "NEW"
          }
        }
      }
    ];

    // ====================================================================
    // Keycloak ì œê±°: ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” Basic Authë§Œ ì‚¬ìš©
    // ====================================================================

    // ====================================================================
    // ì´ˆê¸°í™”
    // ====================================================================
    function init() {
      // ì—ì´ì „íŠ¸ ë° ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ë¡œë“œ
      loadFilterOptions();

      // ì´ˆê¸° íƒ­(case1)ì„ ë¡œë“œëœ ê²ƒìœ¼ë¡œ í‘œì‹œí•˜ê³  iframe ì„¤ì •
      tabLoaded.case1 = true;
      updateDashboardUrls();
    }

    // ====================================================================
    // Dashboard URL ì—…ë°ì´íŠ¸
    // ====================================================================
    function updateDashboardUrls() {
      // case1 íƒ­
      if (currentTab === 'case1') {
        const dateFrom = document.getElementById('dateFrom').value;
        const dateTo = document.getElementById('dateTo').value;
        const timeParam = `_g=(time:(from:'${dateFrom}',to:'${dateTo}'))`;
        const case1Url = `${DASHBOARD_URL}/app/dashboards#/view/${DASHBOARD_IDS.case1}?embed=true&${timeParam}`;
        const iframe1 = document.getElementById('iframe-case1');
        if (iframe1.src !== case1Url) {
          iframe1.src = case1Url;
        }
      }
      // case2 íƒ­
      else if (currentTab === 'case2') {
        const dateFrom = document.getElementById('dateFrom2').value;
        const dateTo = document.getElementById('dateTo2').value;
        const timeParam = `_g=(time:(from:'${dateFrom}',to:'${dateTo}'))`;
        const case2Url = `${DASHBOARD_URL}/app/dashboards#/view/${DASHBOARD_IDS.case2}?embed=true&${timeParam}`;
        const iframe2 = document.getElementById('iframe-case2');
        if (iframe2.src !== case2Url) {
          iframe2.src = case2Url;
        }
      }
    }

    // ====================================================================
    // í•„í„° ì˜µì…˜ ë¡œë“œ
    // ====================================================================
    async function loadFilterOptions() {
      // ëŒ€ë¶„ë¥˜ ëª©ë¡ ë¨¼ì € ë¡œë“œ (API í˜¸ì¶œ ë¶ˆí•„ìš”, í•˜ë“œì½”ë”©ëœ ë°ì´í„°)
      const categoryLargeSelect3 = document.getElementById('categoryLargeFilter3');
      if (categoryLargeSelect3) {
        console.log('[loadFilterOptions] case3 ëŒ€ë¶„ë¥˜ ì˜µì…˜ ì¶”ê°€ ì¤‘...');
        Object.keys(CATEGORY_HIERARCHY).sort().forEach(code => {
          const option = document.createElement('option');
          option.value = code;
          option.textContent = `${code} - ${CATEGORY_HIERARCHY[code].name}`;
          categoryLargeSelect3.appendChild(option);
        });
        console.log('[loadFilterOptions] case3 ëŒ€ë¶„ë¥˜ ì˜µì…˜ ì¶”ê°€ ì™„ë£Œ. ì´', Object.keys(CATEGORY_HIERARCHY).length, 'ê°œ');
      } else {
        console.error('[loadFilterOptions] categoryLargeFilter3 ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
      }

      // ì—ì´ì „íŠ¸ ID ëª©ë¡ (í•˜ë“œì½”ë”©ëœ ë°ì´í„° ì‚¬ìš©)
      try {
        // MOCK_DATAì—ì„œ ê³ ìœ í•œ agent_id ì¶”ì¶œ
        const uniqueAgents = [...new Set(MOCK_DATA.map(doc => doc._source.agent_id))];

        const agentSelect3 = document.getElementById('agentFilter3');
        if (agentSelect3) {
          uniqueAgents.forEach(agentId => {
            const option = document.createElement('option');
            option.value = agentId;
            option.textContent = agentId;
            agentSelect3.appendChild(option);
          });
          console.log('[loadFilterOptions] ì—ì´ì „íŠ¸ ì˜µì…˜ ì¶”ê°€ ì™„ë£Œ:', uniqueAgents.length, 'ê°œ');
        }
      } catch (error) {
        console.error('ì—ì´ì „íŠ¸ í•„í„° ì˜µì…˜ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // ====================================================================
    // ëŒ€ë¶„ë¥˜ ë³€ê²½ ì‹œ ì¤‘ë¶„ë¥˜ í•„í„°ë§
    // ====================================================================
    function onCategoryLargeChange() {
      const largeCode = document.getElementById('categoryLargeFilter').value;
      const mediumSelect = document.getElementById('categoryMediumFilter');
      const smallSelect = document.getElementById('categorySmallFilter');

      // ì¤‘ë¶„ë¥˜/ì†Œë¶„ë¥˜ ì´ˆê¸°í™”
      mediumSelect.innerHTML = '<option value="">ì „ì²´</option>';
      smallSelect.innerHTML = '<option value="">ì „ì²´</option>';
      smallSelect.disabled = true;

      if (!largeCode) {
        mediumSelect.disabled = true;
        return;
      }

      // ì¤‘ë¶„ë¥˜ ì˜µì…˜ ì¶”ê°€
      mediumSelect.disabled = false;
      const mediumData = CATEGORY_HIERARCHY[largeCode].medium;
      Object.keys(mediumData).sort().forEach(code => {
        const option = document.createElement('option');
        option.value = code;
        option.textContent = `${code} - ${mediumData[code].name}`;
        mediumSelect.appendChild(option);
      });
    }

    // ====================================================================
    // ì¤‘ë¶„ë¥˜ ë³€ê²½ ì‹œ ì†Œë¶„ë¥˜ í•„í„°ë§
    // ====================================================================
    function onCategoryMediumChange() {
      const largeCode = document.getElementById('categoryLargeFilter').value;
      const mediumCode = document.getElementById('categoryMediumFilter').value;
      const smallSelect = document.getElementById('categorySmallFilter');

      // ì†Œë¶„ë¥˜ ì´ˆê¸°í™”
      smallSelect.innerHTML = '<option value="">ì „ì²´</option>';
      smallSelect.disabled = true;

      if (!largeCode || !mediumCode) {
        return;
      }

      // ì†Œë¶„ë¥˜ ì˜µì…˜ ì¶”ê°€
      const smallData = CATEGORY_HIERARCHY[largeCode].medium[mediumCode].small;
      if (Object.keys(smallData).length > 0) {
        smallSelect.disabled = false;
        Object.keys(smallData).sort().forEach(code => {
          const option = document.createElement('option');
          option.value = code;
          option.textContent = `${code} - ${smallData[code]}`;
          smallSelect.appendChild(option);
        });
      }
    }

    // Case2ìš© ì¹´í…Œê³ ë¦¬ ë³€ê²½
    function onCategoryLargeChange2() {
      const largeCode = document.getElementById('categoryLargeFilter2').value;
      const mediumSelect = document.getElementById('categoryMediumFilter2');
      const smallSelect = document.getElementById('categorySmallFilter2');
      mediumSelect.innerHTML = '<option value="">ì „ì²´</option>';
      smallSelect.innerHTML = '<option value="">ì „ì²´</option>';
      smallSelect.disabled = true;
      if (!largeCode) {
        mediumSelect.disabled = true;
        return;
      }
      mediumSelect.disabled = false;
      const mediumData = CATEGORY_HIERARCHY[largeCode].medium;
      Object.keys(mediumData).sort().forEach(code => {
        const option = document.createElement('option');
        option.value = code;
        option.textContent = `${code} - ${mediumData[code].name}`;
        mediumSelect.appendChild(option);
      });
    }

    function onCategoryMediumChange2() {
      const largeCode = document.getElementById('categoryLargeFilter2').value;
      const mediumCode = document.getElementById('categoryMediumFilter2').value;
      const smallSelect = document.getElementById('categorySmallFilter2');
      smallSelect.innerHTML = '<option value="">ì „ì²´</option>';
      smallSelect.disabled = true;
      if (!largeCode || !mediumCode) return;
      const smallData = CATEGORY_HIERARCHY[largeCode].medium[mediumCode].small;
      if (Object.keys(smallData).length > 0) {
        smallSelect.disabled = false;
        Object.keys(smallData).sort().forEach(code => {
          const option = document.createElement('option');
          option.value = code;
          option.textContent = `${code} - ${smallData[code]}`;
          smallSelect.appendChild(option);
        });
      }
    }

    // Case3ìš© ì¹´í…Œê³ ë¦¬ ë³€ê²½
    function onCategoryLargeChange3() {
      console.log('[Case3] onCategoryLargeChange3 í˜¸ì¶œë¨');
      const largeCode = document.getElementById('categoryLargeFilter3').value;
      console.log('[Case3] ì„ íƒëœ ëŒ€ë¶„ë¥˜:', largeCode);
      const mediumSelect = document.getElementById('categoryMediumFilter3');
      const smallSelect = document.getElementById('categorySmallFilter3');
      mediumSelect.innerHTML = '<option value="">ì „ì²´</option>';
      smallSelect.innerHTML = '<option value="">ì „ì²´</option>';
      smallSelect.disabled = true;
      if (!largeCode) {
        mediumSelect.disabled = true;
        console.log('[Case3] ëŒ€ë¶„ë¥˜ ì„ íƒ ì•ˆë¨ - ì¤‘ë¶„ë¥˜ ë¹„í™œì„±í™”');
        return;
      }
      mediumSelect.disabled = false;
      const mediumData = CATEGORY_HIERARCHY[largeCode].medium;
      console.log('[Case3] mediumData keys:', Object.keys(mediumData));
      Object.keys(mediumData).sort().forEach(code => {
        const option = document.createElement('option');
        option.value = code;
        option.textContent = `${code} - ${mediumData[code].name}`;
        mediumSelect.appendChild(option);
      });
      console.log('[Case3] ì¤‘ë¶„ë¥˜ í™œì„±í™” ì™„ë£Œ');
    }

    function onCategoryMediumChange3() {
      console.log('[Case3] onCategoryMediumChange3 í˜¸ì¶œë¨');
      const largeCode = document.getElementById('categoryLargeFilter3').value;
      const mediumCode = document.getElementById('categoryMediumFilter3').value;
      console.log('[Case3] ëŒ€ë¶„ë¥˜:', largeCode, 'ì¤‘ë¶„ë¥˜:', mediumCode);
      const smallSelect = document.getElementById('categorySmallFilter3');
      smallSelect.innerHTML = '<option value="">ì „ì²´</option>';
      smallSelect.disabled = true;
      if (!largeCode || !mediumCode) {
        console.log('[Case3] ëŒ€ë¶„ë¥˜ ë˜ëŠ” ì¤‘ë¶„ë¥˜ ì„ íƒ ì•ˆë¨');
        return;
      }
      const smallData = CATEGORY_HIERARCHY[largeCode].medium[mediumCode].small;
      console.log('[Case3] smallData keys:', Object.keys(smallData));
      if (Object.keys(smallData).length > 0) {
        smallSelect.disabled = false;
        Object.keys(smallData).sort().forEach(code => {
          const option = document.createElement('option');
          option.value = code;
          option.textContent = `${code} - ${smallData[code]}`;
          smallSelect.appendChild(option);
        });
        console.log('[Case3] ì†Œë¶„ë¥˜ í™œì„±í™” ì™„ë£Œ');
      } else {
        console.log('[Case3] ì†Œë¶„ë¥˜ ë°ì´í„° ì—†ìŒ');
      }
    }

    // ====================================================================
    // íƒ­ ì „í™˜
    // ====================================================================
    function switchTab(tab) {
      currentTab = tab;

      // íƒ­ ë²„íŠ¼ í™œì„±í™”
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      // íƒ­ ì½˜í…ì¸  í‘œì‹œ
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`tab-${tab}`).classList.add('active');

      // ìµœì´ˆ ë¡œë“œì¸ ê²½ìš°ì—ë§Œ ë°ì´í„° ì¡°íšŒ
      if (!tabLoaded[tab]) {
        tabLoaded[tab] = true;

        if (tab === 'case1' || tab === 'case2') {
          // ëŒ€ì‹œë³´ë“œ íƒ­: iframe URL ì„¤ì •
          updateDashboardUrls();
        } else if (tab === 'case3') {
          // ë°ì´í„° ëª©ë¡ íƒ­: ë°ì´í„° ì¡°íšŒ
          fetchData();
        }
      }
    }

    // ====================================================================
    // ëŒ€ì‹œë³´ë“œ iframe ìƒˆë¡œê³ ì¹¨
    // ====================================================================
    function refreshDashboards(refreshAll = false) {
      // refreshAllì´ trueì´ë©´ ëª¨ë“  ëŒ€ì‹œë³´ë“œ ìƒˆë¡œê³ ì¹¨ (case3ì—ì„œ ì €ì¥ ì‹œ)
      if (refreshAll) {
        ['case1', 'case2'].forEach(tab => {
          refreshSingleDashboard(tab);
        });
        return;
      }

      // case3(ë°ì´í„° ëª©ë¡)ì€ iframeì´ ì—†ìœ¼ë¯€ë¡œ ì œì™¸
      if (currentTab === 'case3') {
        return;
      }

      // í˜„ì¬ í™œì„±í™”ëœ íƒ­ì˜ iframeë§Œ ìƒˆë¡œê³ ì¹¨
      refreshSingleDashboard(currentTab);
    }

    // ë‹¨ì¼ ëŒ€ì‹œë³´ë“œ ìƒˆë¡œê³ ì¹¨
    function refreshSingleDashboard(tab) {
      const frame = document.getElementById(`iframe-${tab}`);
      if (!frame) return;

      // í˜„ì¬ íƒ­ì˜ í•„í„° ê°’ìœ¼ë¡œ URL ì¬ìƒì„± (ê°•ì œ ìƒˆë¡œê³ ì¹¨)
      const suffix = tab === 'case1' ? '' : '2';
      const dateFrom = document.getElementById('dateFrom' + suffix).value;
      const dateTo = document.getElementById('dateTo' + suffix).value;
      const timestamp = new Date().getTime();

      const timeParam = `_g=(time:(from:'${dateFrom}',to:'${dateTo}'))`;
      const newUrl = `${DASHBOARD_URL}/app/dashboards#/view/${DASHBOARD_IDS[tab]}?embed=true&${timeParam}&_t=${timestamp}`;

      // í•­ìƒ ê°•ì œ ë¦¬ë¡œë“œ: ë¹ˆ ë¬¸ìì—´ë¡œ ì´ˆê¸°í™” í›„ ë‹¤ì‹œ ì„¤ì •
      frame.src = '';
      setTimeout(() => {
        frame.src = newUrl;
      }, 50);
    }

    // ====================================================================
    // í•„í„° ì ìš©
    // ====================================================================
    function applyFilters() {
      currentPage = 0;
      updateDashboardUrls();
      if (currentTab === 'case3') {
        fetchData();
      }
    }

    // ====================================================================
    // ë°ì´í„° ì¡°íšŒ
    // ====================================================================
    async function fetchData() {
      // í˜„ì¬ íƒ­ì— ë§ëŠ” í•„í„° ID suffix
      const suffix = currentTab === 'case1' ? '' : currentTab === 'case2' ? '2' : '3';

      const dateFrom = document.getElementById('dateFrom' + suffix).value + ':00';
      const dateTo = document.getElementById('dateTo' + suffix).value + ':59';
      const agentId = document.getElementById('agentFilter' + suffix).value;
      const categoryLarge = document.getElementById('categoryLargeFilter' + suffix).value;
      const categoryMedium = document.getElementById('categoryMediumFilter' + suffix).value;
      const categorySmall = document.getElementById('categorySmallFilter' + suffix).value;
      const status = document.getElementById('statusFilter' + suffix).value;
      const priority = document.getElementById('priorityFilter' + suffix).value;
      const userSummaryKeyword = document.getElementById('userSummaryFilter' + suffix).value.trim();
      const assistantSummaryKeyword = document.getElementById('assistantSummaryFilter' + suffix).value.trim();

      const mustClauses = [
        {
          range: {
            '@timestamp': {
              gte: dateFrom,
              lte: dateTo,
              time_zone: 'Asia/Seoul'
            }
          }
        },
        {
          match_phrase: {
            'dashboard.is_generated': true
          }
        }
      ];

      if (agentId) {
        mustClauses.push({ term: { 'agent_id': agentId } });
      }

      if (categoryLarge) {
        mustClauses.push({ term: { 'dashboard.category_large_keyword': categoryLarge } });
      }

      if (categoryMedium) {
        mustClauses.push({ term: { 'dashboard.category_medium_keyword': categoryMedium } });
      }

      if (categorySmall) {
        mustClauses.push({ term: { 'dashboard.category_small_keyword': categorySmall } });
      }

      if (status) {
        mustClauses.push({ term: { 'dashboard.support_status_keyword': status } });
      }

      if (priority) {
        mustClauses.push({ term: { 'dashboard.support_priority_keyword': priority } });
      }

      if (userSummaryKeyword) {
        mustClauses.push({
          match: {
            'dashboard.user_summary_keyword': {
              query: userSummaryKeyword,
              operator: 'and'
            }
          }
        });
      }

      if (assistantSummaryKeyword) {
        mustClauses.push({
          match: {
            'dashboard.assistant_summary_keyword': {
              query: assistantSummaryKeyword,
              operator: 'and'
            }
          }
        });
      }

      const query = {
        query: { bool: { must: mustClauses } },
        sort: [{ '@timestamp': { order: 'desc' } }],
        from: currentPage * pageSize,
        size: pageSize
      };

      try {
        showLoading(true);

        // ========================================
        // MOCK_DATA ì‚¬ìš© (CORS ë¬¸ì œ íšŒí”¼)
        // ========================================
        console.log('[fetchData] í•˜ë“œì½”ë”©ëœ MOCK_DATA ì‚¬ìš© (ì´ 3ê±´)');

        // í•„í„° ì ìš© (ê°„ë‹¨í•œ í•„í„°ë§)
        let filteredData = MOCK_DATA.filter(item => {
          const source = item._source;
          const dashboard = source.dashboard || {};

          // ì—ì´ì „íŠ¸ ID í•„í„°
          if (agentId && source.agent_id !== agentId) return false;

          // ì¹´í…Œê³ ë¦¬ í•„í„°
          if (categoryLarge && dashboard.category_large_code_keyword !== categoryLarge) return false;
          if (categoryMedium && dashboard.category_medium_code_keyword !== categoryMedium) return false;
          if (categorySmall && dashboard.category_small_code_keyword !== categorySmall) return false;

          // ìƒíƒœ í•„í„°
          if (status && dashboard.support_status_keyword !== status) return false;

          // ìš°ì„ ìˆœìœ„ í•„í„°
          if (priority && dashboard.support_priority_keyword !== priority) return false;

          // ê²€ìƒ‰ í‚¤ì›Œë“œ í•„í„°
          if (userSummaryKeyword && !dashboard.user_summary_search?.includes(userSummaryKeyword)) return false;
          if (assistantSummaryKeyword && !dashboard.assistant_summary_search?.includes(assistantSummaryKeyword)) return false;

          return true;
        });

        // í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
        const from = currentPage * pageSize;
        const paginatedData = filteredData.slice(from, from + pageSize);

        currentData = paginatedData;
        totalCount = filteredData.length;

        console.log(`[fetchData] í•„í„°ë§ í›„: ${totalCount}ê±´, í˜„ì¬ í˜ì´ì§€: ${paginatedData.length}ê±´`);

        renderGrid(currentData);
        updatePagination(totalCount);
      } catch (error) {
        console.error('ì¡°íšŒ ì˜¤ë¥˜:', error);
        alert(`ë°ì´í„° ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ${error.message}`);
      } finally {
        showLoading(false);
      }
    }

    // ====================================================================
    // Grid ë Œë”ë§
    // ====================================================================
    function renderGrid(data) {
      const tbody = document.getElementById('gridBody');
      tbody.innerHTML = '';

      if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 50px; color: #999;">ì¡°íšŒëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        document.getElementById('totalCount').textContent = '0';
        return;
      }

      data.forEach((item, index) => {
        const source = item._source;
        const dashboard = source.dashboard || {};
        const row = document.createElement('tr');

        row.innerHTML = `
          <td onclick="openModalByIndex(${index})">${formatDateTime(source['@timestamp'])}</td>
          <td onclick="openModalByIndex(${index})">${source.session_id || '-'}</td>
          <td onclick="openModalByIndex(${index})">${dashboard.category_large_code_keyword || '-'}</td>
          <td onclick="openModalByIndex(${index})">${dashboard.category_medium_code_keyword || '-'}</td>
          <td onclick="openModalByIndex(${index})">${dashboard.category_small_code_keyword || '-'}</td>
          <td onclick="openModalByIndex(${index})" class="ellipsis" title="${dashboard.user_summary_search || ''}">${dashboard.user_summary_search || '-'}</td>
          <td onclick="openModalByIndex(${index})" class="ellipsis" title="${dashboard.assistant_summary_search || ''}">${dashboard.assistant_summary_search || '-'}</td>
          <td onclick="openModalByIndex(${index})">${renderStatusBadge(dashboard.support_status_keyword)}</td>
          <td onclick="openModalByIndex(${index})">${renderPriorityBadge(dashboard.support_priority_keyword)}</td>
          <td>${renderHistoryButton(dashboard.memo_hist || [], index)}</td>
        `;

        tbody.appendChild(row);
      });

      document.getElementById('totalCount').textContent = totalCount.toLocaleString();
    }

    // ====================================================================
    // ë±ƒì§€ ë Œë”ë§
    // ====================================================================
    function renderStatusBadge(status) {
      if (!status) return '-';
      const badgeClass = status === 'OPEN' ? 'badge-open' :
                         status === 'IN_PROGRESS' ? 'badge-in-progress' :
                         status === 'CLOSED' ? 'badge-closed' : '';
      return `<span class="badge ${badgeClass}">${status}</span>`;
    }

    function renderPriorityBadge(priority) {
      if (!priority) return '-';
      const badgeClass = priority === 'LOW' ? 'badge-low' :
                         priority === 'MEDIUM' ? 'badge-medium' :
                         priority === 'HIGH' ? 'badge-high' :
                         priority === 'URGENT' ? 'badge-urgent' : '';
      return `<span class="badge ${badgeClass}">${priority}</span>`;
    }

    function renderHistoryButton(memoHist, dataIndex) {
      if (!memoHist || memoHist.length === 0) {
        return '-';
      }

      const count = memoHist.length;
      const lastEntry = memoHist[memoHist.length - 1];
      const lastUser = lastEntry.created_by || 'Unknown';

      return `<button class="history-btn" onclick="event.stopPropagation(); openHistoryModal(${dataIndex})">
        ${count}ê±´ (${lastUser})
      </button>`;
    }

    // ====================================================================
    // ì´ë ¥ ëª¨ë‹¬
    // ====================================================================
    function openModalByIndex(index) {
      openModal(currentData[index]);
    }

    function openHistoryModal(dataIndex) {
      const item = currentData[dataIndex];
      const memoHist = item._source.dashboard?.memo_hist || [];

      const historyContent = document.getElementById('historyContent');

      if (memoHist.length === 0) {
        historyContent.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
      } else {
        let html = '<div class="history-timeline">';

        // ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬ (ì—­ìˆœ)
        [...memoHist].reverse().forEach((entry, index) => {
          const isLatest = index === 0;
          const createdAt = entry.created_at ? new Date(entry.created_at).toLocaleString('ko-KR') : '-';

          html += `
            <div class="history-item ${isLatest ? 'latest' : ''}">
              <div class="history-header">
                <span class="history-date">ğŸ•’ ${createdAt}</span>
                <span class="history-user">ğŸ‘¤ ${entry.created_by || 'Unknown'}</span>
                ${isLatest ? '<span class="badge badge-latest">ìµœì‹ </span>' : ''}
              </div>
              <div class="history-memo">
                <strong>ìˆ˜ì • ì‚¬ìœ :</strong> ${entry.memo || '-'}
              </div>
              <div class="history-changes">
                ${renderHistoryChanges(entry.before, entry.after)}
              </div>
            </div>
          `;
        });

        html += '</div>';
        historyContent.innerHTML = html;
      }

      document.getElementById('historyModal').classList.add('active');
    }

    function renderHistoryChanges(before, after) {
      const fieldLabels = {
        'category_code': 'ì¹´í…Œê³ ë¦¬ ì½”ë“œ',
        'category_large': 'ëŒ€ë¶„ë¥˜',
        'category_medium': 'ì¤‘ë¶„ë¥˜',
        'category_small': 'ì†Œë¶„ë¥˜',
        'user_summary': 'ì‚¬ìš©ì ìš”ì•½',
        'assistant_summary': 'ì–´ì‹œìŠ¤í„´íŠ¸ ìš”ì•½',
        'support_status': 'ìƒíƒœ',
        'support_priority': 'ìš°ì„ ìˆœìœ„'
      };

      // beforeê°€ nullì¸ ê²½ìš° (ìµœì´ˆ ë“±ë¡)
      if (!before && after) {
        let html = '<table class="history-changes-table">';
        html += '<thead><tr><th>í•„ë“œ</th><th>ê°’</th></tr></thead><tbody>';

        for (const [field, value] of Object.entries(after)) {
          const label = fieldLabels[field] || field;
          html += `
            <tr>
              <td><strong>${label}</strong></td>
              <td class="new-value">${value !== null && value !== undefined ? value : '-'}</td>
            </tr>
          `;
        }

        html += '</tbody></table>';
        return html;
      }

      // afterê°€ ì—†ëŠ” ê²½ìš°
      if (!after) {
        return '<p style="color: #999;">ë³€ê²½ ë‚´ì—­ ì—†ìŒ</p>';
      }

      // beforeì™€ afterê°€ ëª¨ë‘ ìˆëŠ” ê²½ìš° (ìˆ˜ì •)
      let html = '<table class="history-changes-table">';
      html += '<thead><tr><th>í•„ë“œ</th><th>ì´ì „ ê°’</th><th>ë³€ê²½ ê°’</th></tr></thead><tbody>';

      // beforeì™€ afterì˜ ëª¨ë“  í•„ë“œë¥¼ ë³‘í•©
      const allFields = new Set([...Object.keys(before || {}), ...Object.keys(after)]);

      for (const field of allFields) {
        const oldValue = before?.[field];
        const newValue = after[field];
        const label = fieldLabels[field] || field;

        // ê°’ì´ ë³€ê²½ëœ í•„ë“œë§Œ í‘œì‹œ
        if (oldValue !== newValue) {
          html += `
            <tr>
              <td><strong>${label}</strong></td>
              <td class="old-value">${oldValue !== null && oldValue !== undefined ? oldValue : '-'}</td>
              <td class="new-value">${newValue !== null && newValue !== undefined ? newValue : '-'}</td>
            </tr>
          `;
        }
      }

      html += '</tbody></table>';
      return html;
    }

    function closeHistoryModal() {
      document.getElementById('historyModal').classList.remove('active');
    }

    // ====================================================================
    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
    // ====================================================================
    function formatDateTime(isoString) {
      if (!isoString) return '-';
      const date = new Date(isoString);
      return date.toLocaleString('ko-KR', {
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
    }

    function showLoading(show) {
      document.getElementById('loadingIndicator').classList.toggle('active', show);
      document.querySelector('.table-wrapper').style.display = show ? 'none' : 'block';
    }

    // ====================================================================
    // í˜ì´ì§€ë„¤ì´ì…˜
    // ====================================================================
    function updatePagination(total) {
      const totalPages = Math.ceil(total / pageSize);
      document.getElementById('pageInfo').textContent = `${currentPage + 1} / ${totalPages || 1}`;

      document.getElementById('prevBtn').disabled = currentPage === 0;
      document.getElementById('nextBtn').disabled = currentPage >= totalPages - 1 || totalPages === 0;
    }

    function prevPage() {
      if (currentPage > 0) {
        currentPage--;
        fetchData();
      }
    }

    function nextPage() {
      const totalPages = Math.ceil(totalCount / pageSize);
      if (currentPage < totalPages - 1) {
        currentPage++;
        fetchData();
      }
    }

    // ====================================================================
    // ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
    // ====================================================================
    function openModal(doc) {
      selectedDoc = doc;
      const dashboard = doc._source.dashboard || {};

      document.getElementById('modal_session_id').value = doc._source.session_id || '';
      document.getElementById('modal_user_summary').value = dashboard.user_summary_keyword || '';
      document.getElementById('modal_assistant_summary').value = dashboard.assistant_summary_keyword || '';
      document.getElementById('modal_category_code').value = dashboard.category_code_keyword || '';
      document.getElementById('modal_category_large').value = dashboard.category_large_keyword || '';
      document.getElementById('modal_category_medium').value = dashboard.category_medium_keyword || '';
      document.getElementById('modal_category_small').value = dashboard.category_small_keyword || '';
      document.getElementById('modal_support_status').value = dashboard.support_status_keyword || 'OPEN';
      document.getElementById('modal_support_priority').value = dashboard.support_priority_keyword || 'LOW';
      document.getElementById('modal_memo').value = '';

      document.getElementById('editModal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('editModal').classList.remove('active');
      selectedDoc = null;
    }

    // ====================================================================
    // ì €ì¥ í•¨ìˆ˜
    // ====================================================================
    async function saveChanges() {
      if (!selectedDoc) return;

      const memo = document.getElementById('modal_memo').value.trim();
      if (!memo) {
        alert('ìˆ˜ì • ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const originalDashboard = selectedDoc._source.dashboard || {};
      const now = new Date().toISOString();
      const username = 'admin'; // TODO: ì‹¤ì œ ì‚¬ìš©ì ID

      // ë³€ê²½ëœ í•„ë“œ ìˆ˜ì§‘
      const fields = {
        'user_summary': document.getElementById('modal_user_summary').value,
        'assistant_summary': document.getElementById('modal_assistant_summary').value,
        'category_code': document.getElementById('modal_category_code').value,
        'category_large': document.getElementById('modal_category_large').value,
        'category_medium': document.getElementById('modal_category_medium').value,
        'category_small': document.getElementById('modal_category_small').value,
        'support_status': document.getElementById('modal_support_status').value,
        'support_priority': document.getElementById('modal_support_priority').value
      };

      const before = {};
      const after = {};
      const scriptLines = [];
      const scriptParams = {};

      for (const [field, newValue] of Object.entries(fields)) {
        const fieldWithKeyword = field + '_keyword';
        const oldValue = originalDashboard[fieldWithKeyword] || '';
        if (oldValue !== newValue) {
          // í•„ë“œ ì—…ë°ì´íŠ¸ (_keyword í•„ë“œì— ì €ì¥)
          scriptLines.push(`ctx._source.dashboard.${fieldWithKeyword} = params.${field};`);
          scriptParams[field] = newValue;

          // before/after ê°ì²´ êµ¬ì„± (keyword ì—†ì´ ì €ì¥)
          before[field] = oldValue;
          after[field] = newValue;
        }
      }

      if (Object.keys(before).length === 0) {
        alert('ë³€ê²½ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // memo_histì— ì´ë ¥ ì¶”ê°€
      scriptLines.push(`
        if (ctx._source.dashboard.memo_hist == null) {
          ctx._source.dashboard.memo_hist = [];
        }
        ctx._source.dashboard.memo_hist.add(params.history_entry);
      `);

      scriptParams.history_entry = {
        memo: memo,
        created_at: now,
        created_by: username,
        before: before,
        after: after
      };

      const updateBody = {
        script: {
          source: scriptLines.join('\n'),
          params: scriptParams
        }
      };

      try {
        const response = await fetch(`${OPENSEARCH_URL}/${selectedDoc._index}/_update/${selectedDoc._id}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Basic ' + btoa(`${OPENSEARCH_BASIC_USER}:${OPENSEARCH_BASIC_PASS}`)
          },
          body: JSON.stringify(updateBody)
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${response.status}\n${errorText}`);
        }

        alert(`ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\n\në³€ê²½ëœ í•„ë“œ: ${Object.keys(before).length}ê°œ`);
        closeModal();
        fetchData();

        // ëŒ€ì‹œë³´ë“œ iframe ìƒˆë¡œê³ ì¹¨ (ìºì‹œ ì œê±°)
        // case3ì—ì„œ ì €ì¥ ì‹œ ëª¨ë“  ëŒ€ì‹œë³´ë“œ ìƒˆë¡œê³ ì¹¨
        refreshDashboards(true);
      } catch (error) {
        console.error('ì €ì¥ ì˜¤ë¥˜:', error);
        alert(`ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ${error.message}`);
      }
    }

    // ====================================================================
    // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
    // ====================================================================
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
      }
    });

    // ====================================================================
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” (Keycloak ë¨¼ì €)
    // ====================================================================
    // ë¡œì»¬ í™˜ê²½: Keycloak ì—†ì´ ë°”ë¡œ ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
